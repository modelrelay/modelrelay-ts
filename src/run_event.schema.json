{
  "$id": "https://modelrelay.ai/schemas/run_event.schema.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "additionalProperties": false,
  "definitions": {
    "nodeError": {
      "additionalProperties": false,
      "properties": {
        "code": {
          "type": "string"
        },
        "message": {
          "minLength": 1,
          "type": "string"
        }
      },
      "required": [
        "message"
      ],
      "type": "object"
    },
    "nodeLLMCall": {
      "additionalProperties": false,
      "properties": {
        "model": {
          "type": "string"
        },
        "provider": {
          "type": "string"
        },
        "request_id": {
          "format": "uuid",
          "type": "string"
        },
        "response_id": {
          "type": "string"
        },
        "step": {
          "minimum": 0,
          "type": "integer"
        },
        "stop_reason": {
          "type": "string"
        },
        "usage": {
          "$ref": "#/definitions/tokenUsage"
        }
      },
      "required": [
        "step",
        "request_id"
      ],
      "type": "object"
    },
    "nodeOutputDelta": {
      "additionalProperties": false,
      "properties": {
        "kind": {
          "minLength": 1,
          "type": "string"
        },
        "model": {
          "type": "string"
        },
        "response_id": {
          "type": "string"
        },
        "text_delta": {
          "type": "string"
        }
      },
      "required": [
        "kind"
      ],
      "type": "object"
    },
    "nodeToolCall": {
      "additionalProperties": false,
      "properties": {
        "request_id": {
          "format": "uuid",
          "type": "string"
        },
        "step": {
          "minimum": 0,
          "type": "integer"
        },
        "tool_call": {
          "$ref": "#/definitions/toolCallWithArguments"
        }
      },
      "required": [
        "step",
        "request_id",
        "tool_call"
      ],
      "type": "object"
    },
    "nodeToolResult": {
      "additionalProperties": false,
      "properties": {
        "error": {
          "type": "string"
        },
        "output": {
          "type": "string"
        },
        "request_id": {
          "format": "uuid",
          "type": "string"
        },
        "step": {
          "minimum": 0,
          "type": "integer"
        },
        "tool_call": {
          "$ref": "#/definitions/toolCall"
        }
      },
      "required": [
        "step",
        "request_id",
        "tool_call",
        "output"
      ],
      "type": "object"
    },
    "nodeUserAnswer": {
      "additionalProperties": false,
      "properties": {
        "answer": {
          "type": "string"
        },
        "is_freeform": {
          "type": "boolean"
        },
        "request_id": {
          "format": "uuid",
          "type": "string"
        },
        "step": {
          "minimum": 0,
          "type": "integer"
        },
        "tool_call": {
          "$ref": "#/definitions/toolCall"
        }
      },
      "required": [
        "step",
        "request_id",
        "tool_call",
        "answer",
        "is_freeform"
      ],
      "type": "object"
    },
    "nodeUserAsk": {
      "additionalProperties": false,
      "properties": {
        "allow_freeform": {
          "type": "boolean"
        },
        "options": {
          "items": {
            "$ref": "#/definitions/userAskOption"
          },
          "type": "array"
        },
        "question": {
          "minLength": 1,
          "type": "string"
        },
        "request_id": {
          "format": "uuid",
          "type": "string"
        },
        "step": {
          "minimum": 0,
          "type": "integer"
        },
        "tool_call": {
          "$ref": "#/definitions/toolCallWithArguments"
        }
      },
      "required": [
        "step",
        "request_id",
        "tool_call",
        "question",
        "allow_freeform"
      ],
      "type": "object"
    },
    "nodeWaiting": {
      "additionalProperties": false,
      "properties": {
        "pending_tool_calls": {
          "items": {
            "$ref": "#/definitions/pendingToolCall"
          },
          "minItems": 1,
          "type": "array"
        },
        "reason": {
          "minLength": 1,
          "type": "string"
        },
        "request_id": {
          "format": "uuid",
          "type": "string"
        },
        "step": {
          "minimum": 0,
          "type": "integer"
        }
      },
      "required": [
        "step",
        "request_id",
        "pending_tool_calls",
        "reason"
      ],
      "type": "object"
    },
    "payloadArtifact": {
      "additionalProperties": false,
      "properties": {
        "artifact_key": {
          "type": "string"
        },
        "content": {},
        "info": {
          "$ref": "#/definitions/payloadInfo"
        }
      },
      "required": [
        "artifact_key",
        "info"
      ],
      "type": "object"
    },
    "payloadInfo": {
      "additionalProperties": false,
      "properties": {
        "bytes": {
          "minimum": 0,
          "type": "integer"
        },
        "included": {
          "type": "boolean"
        },
        "sha256": {
          "pattern": "^[0-9a-f]{64}$",
          "type": "string"
        }
      },
      "required": [
        "bytes",
        "sha256",
        "included"
      ],
      "type": "object"
    },
    "pendingToolCall": {
      "additionalProperties": false,
      "properties": {
        "tool_call": {
          "$ref": "#/definitions/toolCallWithArguments"
        }
      },
      "required": [
        "tool_call"
      ],
      "type": "object"
    },
    "tokenUsage": {
      "additionalProperties": false,
      "properties": {
        "input_tokens": {
          "minimum": 0,
          "type": "integer"
        },
        "output_tokens": {
          "minimum": 0,
          "type": "integer"
        },
        "total_tokens": {
          "minimum": 0,
          "type": "integer"
        }
      },
      "type": "object"
    },
    "toolCall": {
      "additionalProperties": false,
      "properties": {
        "arguments": {
          "type": "string"
        },
        "id": {
          "minLength": 1,
          "type": "string"
        },
        "name": {
          "minLength": 1,
          "type": "string"
        }
      },
      "required": [
        "id",
        "name"
      ],
      "type": "object"
    },
    "toolCallWithArguments": {
      "allOf": [
        {
          "$ref": "#/definitions/toolCall"
        },
        {
          "required": [
            "arguments"
          ]
        }
      ]
    },
    "userAskOption": {
      "additionalProperties": false,
      "properties": {
        "description": {
          "type": "string"
        },
        "label": {
          "minLength": 1,
          "type": "string"
        }
      },
      "required": [
        "label"
      ],
      "type": "object"
    }
  },
  "oneOf": [
    {
      "allOf": [
        {
          "properties": {
            "type": {
              "const": "run_compiled"
            }
          },
          "required": [
            "plan_hash"
          ]
        },
        {
          "not": {
            "required": [
              "node_id"
            ]
          }
        },
        {
          "not": {
            "required": [
              "output"
            ]
          }
        },
        {
          "not": {
            "required": [
              "llm_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_result"
            ]
          }
        },
        {
          "not": {
            "required": [
              "waiting"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_ask"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_answer"
            ]
          }
        },
        {
          "not": {
            "required": [
              "delta"
            ]
          }
        },
        {
          "not": {
            "required": [
              "outputs"
            ]
          }
        },
        {
          "not": {
            "required": [
              "task_list"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory_key"
            ]
          }
        }
      ]
    },
    {
      "allOf": [
        {
          "properties": {
            "type": {
              "const": "run_started"
            }
          },
          "required": [
            "plan_hash"
          ]
        },
        {
          "not": {
            "required": [
              "node_id"
            ]
          }
        },
        {
          "not": {
            "required": [
              "output"
            ]
          }
        },
        {
          "not": {
            "required": [
              "llm_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_result"
            ]
          }
        },
        {
          "not": {
            "required": [
              "waiting"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_ask"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_answer"
            ]
          }
        },
        {
          "not": {
            "required": [
              "delta"
            ]
          }
        },
        {
          "not": {
            "required": [
              "outputs"
            ]
          }
        },
        {
          "not": {
            "required": [
              "task_list"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory_key"
            ]
          }
        }
      ]
    },
    {
      "allOf": [
        {
          "properties": {
            "type": {
              "const": "run_completed"
            }
          },
          "required": [
            "plan_hash",
            "outputs"
          ]
        },
        {
          "not": {
            "required": [
              "node_id"
            ]
          }
        },
        {
          "not": {
            "required": [
              "output"
            ]
          }
        },
        {
          "not": {
            "required": [
              "llm_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_result"
            ]
          }
        },
        {
          "not": {
            "required": [
              "waiting"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_ask"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_answer"
            ]
          }
        },
        {
          "not": {
            "required": [
              "delta"
            ]
          }
        },
        {
          "not": {
            "required": [
              "task_list"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory_key"
            ]
          }
        }
      ]
    },
    {
      "allOf": [
        {
          "properties": {
            "type": {
              "const": "run_failed"
            }
          },
          "required": [
            "plan_hash",
            "error"
          ]
        },
        {
          "not": {
            "required": [
              "node_id"
            ]
          }
        },
        {
          "not": {
            "required": [
              "output"
            ]
          }
        },
        {
          "not": {
            "required": [
              "llm_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_result"
            ]
          }
        },
        {
          "not": {
            "required": [
              "waiting"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_ask"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_answer"
            ]
          }
        },
        {
          "not": {
            "required": [
              "delta"
            ]
          }
        },
        {
          "not": {
            "required": [
              "outputs"
            ]
          }
        },
        {
          "not": {
            "required": [
              "task_list"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory_key"
            ]
          }
        }
      ]
    },
    {
      "allOf": [
        {
          "properties": {
            "type": {
              "const": "run_canceled"
            }
          },
          "required": [
            "plan_hash",
            "error"
          ]
        },
        {
          "not": {
            "required": [
              "node_id"
            ]
          }
        },
        {
          "not": {
            "required": [
              "output"
            ]
          }
        },
        {
          "not": {
            "required": [
              "llm_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_result"
            ]
          }
        },
        {
          "not": {
            "required": [
              "waiting"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_ask"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_answer"
            ]
          }
        },
        {
          "not": {
            "required": [
              "delta"
            ]
          }
        },
        {
          "not": {
            "required": [
              "outputs"
            ]
          }
        },
        {
          "not": {
            "required": [
              "task_list"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory_key"
            ]
          }
        }
      ]
    },
    {
      "allOf": [
        {
          "properties": {
            "type": {
              "const": "task_list_updated"
            }
          },
          "required": [
            "plan_hash",
            "task_list"
          ]
        },
        {
          "not": {
            "required": [
              "node_id"
            ]
          }
        },
        {
          "not": {
            "required": [
              "output"
            ]
          }
        },
        {
          "not": {
            "required": [
              "llm_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_result"
            ]
          }
        },
        {
          "not": {
            "required": [
              "waiting"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_ask"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_answer"
            ]
          }
        },
        {
          "not": {
            "required": [
              "delta"
            ]
          }
        },
        {
          "not": {
            "required": [
              "outputs"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory_key"
            ]
          }
        },
        {
          "properties": {
            "task_list": {
              "properties": {
                "info": {
                  "properties": {
                    "included": {
                      "const": false
                    }
                  }
                }
              }
            }
          }
        }
      ]
    },
    {
      "allOf": [
        {
          "properties": {
            "type": {
              "const": "memory_updated"
            }
          },
          "required": [
            "plan_hash",
            "memory",
            "memory_key"
          ]
        },
        {
          "not": {
            "required": [
              "node_id"
            ]
          }
        },
        {
          "not": {
            "required": [
              "output"
            ]
          }
        },
        {
          "not": {
            "required": [
              "llm_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_result"
            ]
          }
        },
        {
          "not": {
            "required": [
              "waiting"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_ask"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_answer"
            ]
          }
        },
        {
          "not": {
            "required": [
              "delta"
            ]
          }
        },
        {
          "not": {
            "required": [
              "outputs"
            ]
          }
        },
        {
          "not": {
            "required": [
              "task_list"
            ]
          }
        },
        {
          "properties": {
            "memory": {
              "properties": {
                "info": {
                  "properties": {
                    "included": {
                      "const": false
                    }
                  }
                }
              }
            }
          }
        }
      ]
    },
    {
      "allOf": [
        {
          "properties": {
            "type": {
              "const": "node_llm_call"
            }
          },
          "required": [
            "node_id",
            "llm_call"
          ]
        },
        {
          "not": {
            "required": [
              "plan_hash"
            ]
          }
        },
        {
          "not": {
            "required": [
              "output"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_result"
            ]
          }
        },
        {
          "not": {
            "required": [
              "waiting"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_ask"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_answer"
            ]
          }
        },
        {
          "not": {
            "required": [
              "delta"
            ]
          }
        },
        {
          "not": {
            "required": [
              "outputs"
            ]
          }
        },
        {
          "not": {
            "required": [
              "task_list"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory_key"
            ]
          }
        }
      ]
    },
    {
      "allOf": [
        {
          "properties": {
            "type": {
              "const": "node_tool_call"
            }
          },
          "required": [
            "node_id",
            "tool_call"
          ]
        },
        {
          "not": {
            "required": [
              "plan_hash"
            ]
          }
        },
        {
          "not": {
            "required": [
              "output"
            ]
          }
        },
        {
          "not": {
            "required": [
              "llm_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_result"
            ]
          }
        },
        {
          "not": {
            "required": [
              "waiting"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_ask"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_answer"
            ]
          }
        },
        {
          "not": {
            "required": [
              "delta"
            ]
          }
        },
        {
          "not": {
            "required": [
              "outputs"
            ]
          }
        },
        {
          "not": {
            "required": [
              "task_list"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory_key"
            ]
          }
        }
      ]
    },
    {
      "allOf": [
        {
          "properties": {
            "type": {
              "const": "node_tool_result"
            }
          },
          "required": [
            "node_id",
            "tool_result"
          ]
        },
        {
          "not": {
            "required": [
              "plan_hash"
            ]
          }
        },
        {
          "not": {
            "required": [
              "output"
            ]
          }
        },
        {
          "not": {
            "required": [
              "llm_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "waiting"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_ask"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_answer"
            ]
          }
        },
        {
          "not": {
            "required": [
              "delta"
            ]
          }
        },
        {
          "not": {
            "required": [
              "outputs"
            ]
          }
        },
        {
          "not": {
            "required": [
              "task_list"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory_key"
            ]
          }
        }
      ]
    },
    {
      "allOf": [
        {
          "properties": {
            "type": {
              "const": "node_waiting"
            }
          },
          "required": [
            "node_id",
            "waiting"
          ]
        },
        {
          "not": {
            "required": [
              "plan_hash"
            ]
          }
        },
        {
          "not": {
            "required": [
              "output"
            ]
          }
        },
        {
          "not": {
            "required": [
              "llm_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_result"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_ask"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_answer"
            ]
          }
        },
        {
          "not": {
            "required": [
              "delta"
            ]
          }
        },
        {
          "not": {
            "required": [
              "outputs"
            ]
          }
        },
        {
          "not": {
            "required": [
              "task_list"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory_key"
            ]
          }
        }
      ]
    },
    {
      "allOf": [
        {
          "properties": {
            "type": {
              "const": "node_user_ask"
            }
          },
          "required": [
            "node_id",
            "user_ask"
          ]
        },
        {
          "not": {
            "required": [
              "plan_hash"
            ]
          }
        },
        {
          "not": {
            "required": [
              "output"
            ]
          }
        },
        {
          "not": {
            "required": [
              "llm_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_result"
            ]
          }
        },
        {
          "not": {
            "required": [
              "waiting"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_answer"
            ]
          }
        },
        {
          "not": {
            "required": [
              "delta"
            ]
          }
        },
        {
          "not": {
            "required": [
              "outputs"
            ]
          }
        },
        {
          "not": {
            "required": [
              "task_list"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory_key"
            ]
          }
        }
      ]
    },
    {
      "allOf": [
        {
          "properties": {
            "type": {
              "const": "node_user_answer"
            }
          },
          "required": [
            "node_id",
            "user_answer"
          ]
        },
        {
          "not": {
            "required": [
              "plan_hash"
            ]
          }
        },
        {
          "not": {
            "required": [
              "output"
            ]
          }
        },
        {
          "not": {
            "required": [
              "llm_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_result"
            ]
          }
        },
        {
          "not": {
            "required": [
              "waiting"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_ask"
            ]
          }
        },
        {
          "not": {
            "required": [
              "delta"
            ]
          }
        },
        {
          "not": {
            "required": [
              "outputs"
            ]
          }
        },
        {
          "not": {
            "required": [
              "task_list"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory_key"
            ]
          }
        }
      ]
    },
    {
      "allOf": [
        {
          "properties": {
            "type": {
              "const": "node_started"
            }
          },
          "required": [
            "node_id"
          ]
        },
        {
          "not": {
            "required": [
              "plan_hash"
            ]
          }
        },
        {
          "not": {
            "required": [
              "output"
            ]
          }
        },
        {
          "not": {
            "required": [
              "llm_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_result"
            ]
          }
        },
        {
          "not": {
            "required": [
              "waiting"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_ask"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_answer"
            ]
          }
        },
        {
          "not": {
            "required": [
              "delta"
            ]
          }
        },
        {
          "not": {
            "required": [
              "outputs"
            ]
          }
        },
        {
          "not": {
            "required": [
              "task_list"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory_key"
            ]
          }
        }
      ]
    },
    {
      "allOf": [
        {
          "properties": {
            "type": {
              "const": "node_succeeded"
            }
          },
          "required": [
            "node_id"
          ]
        },
        {
          "not": {
            "required": [
              "plan_hash"
            ]
          }
        },
        {
          "not": {
            "required": [
              "output"
            ]
          }
        },
        {
          "not": {
            "required": [
              "llm_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_result"
            ]
          }
        },
        {
          "not": {
            "required": [
              "waiting"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_ask"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_answer"
            ]
          }
        },
        {
          "not": {
            "required": [
              "delta"
            ]
          }
        },
        {
          "not": {
            "required": [
              "outputs"
            ]
          }
        },
        {
          "not": {
            "required": [
              "task_list"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory_key"
            ]
          }
        }
      ]
    },
    {
      "allOf": [
        {
          "properties": {
            "type": {
              "const": "node_failed"
            }
          },
          "required": [
            "node_id",
            "error"
          ]
        },
        {
          "not": {
            "required": [
              "plan_hash"
            ]
          }
        },
        {
          "not": {
            "required": [
              "output"
            ]
          }
        },
        {
          "not": {
            "required": [
              "llm_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_result"
            ]
          }
        },
        {
          "not": {
            "required": [
              "waiting"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_ask"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_answer"
            ]
          }
        },
        {
          "not": {
            "required": [
              "delta"
            ]
          }
        },
        {
          "not": {
            "required": [
              "outputs"
            ]
          }
        },
        {
          "not": {
            "required": [
              "task_list"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory_key"
            ]
          }
        }
      ]
    },
    {
      "allOf": [
        {
          "properties": {
            "type": {
              "const": "node_output_delta"
            }
          },
          "required": [
            "node_id",
            "delta"
          ]
        },
        {
          "not": {
            "required": [
              "plan_hash"
            ]
          }
        },
        {
          "not": {
            "required": [
              "output"
            ]
          }
        },
        {
          "not": {
            "required": [
              "llm_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_result"
            ]
          }
        },
        {
          "not": {
            "required": [
              "waiting"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_ask"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_answer"
            ]
          }
        },
        {
          "not": {
            "required": [
              "outputs"
            ]
          }
        },
        {
          "not": {
            "required": [
              "task_list"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory_key"
            ]
          }
        }
      ]
    },
    {
      "allOf": [
        {
          "properties": {
            "type": {
              "const": "node_output"
            }
          },
          "required": [
            "node_id",
            "output"
          ]
        },
        {
          "not": {
            "required": [
              "plan_hash"
            ]
          }
        },
        {
          "not": {
            "required": [
              "llm_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_call"
            ]
          }
        },
        {
          "not": {
            "required": [
              "tool_result"
            ]
          }
        },
        {
          "not": {
            "required": [
              "waiting"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_ask"
            ]
          }
        },
        {
          "not": {
            "required": [
              "user_answer"
            ]
          }
        },
        {
          "not": {
            "required": [
              "delta"
            ]
          }
        },
        {
          "not": {
            "required": [
              "outputs"
            ]
          }
        },
        {
          "not": {
            "required": [
              "task_list"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory"
            ]
          }
        },
        {
          "not": {
            "required": [
              "memory_key"
            ]
          }
        }
      ]
    }
  ],
  "properties": {
    "delta": {
      "$ref": "#/definitions/nodeOutputDelta"
    },
    "envelope_version": {
      "const": "v2",
      "type": "string"
    },
    "error": {
      "$ref": "#/definitions/nodeError"
    },
    "llm_call": {
      "$ref": "#/definitions/nodeLLMCall"
    },
    "memory": {
      "$ref": "#/definitions/payloadArtifact"
    },
    "memory_key": {
      "type": "string"
    },
    "node_id": {
      "minLength": 1,
      "type": "string"
    },
    "output": {
      "$ref": "#/definitions/payloadArtifact"
    },
    "outputs": {
      "$ref": "#/definitions/payloadArtifact"
    },
    "plan_hash": {
      "pattern": "^[0-9a-f]{64}$",
      "type": "string"
    },
    "run_id": {
      "format": "uuid",
      "type": "string"
    },
    "seq": {
      "minimum": 1,
      "type": "integer"
    },
    "task_list": {
      "$ref": "#/definitions/payloadArtifact"
    },
    "tool_call": {
      "$ref": "#/definitions/nodeToolCall"
    },
    "tool_result": {
      "$ref": "#/definitions/nodeToolResult"
    },
    "ts": {
      "format": "date-time",
      "type": "string"
    },
    "type": {
      "enum": [
        "run_compiled",
        "run_started",
        "run_completed",
        "run_failed",
        "run_canceled",
        "task_list_updated",
        "memory_updated",
        "node_llm_call",
        "node_tool_call",
        "node_tool_result",
        "node_waiting",
        "node_user_ask",
        "node_user_answer",
        "node_started",
        "node_succeeded",
        "node_failed",
        "node_output_delta",
        "node_output"
      ],
      "type": "string"
    },
    "user_answer": {
      "$ref": "#/definitions/nodeUserAnswer"
    },
    "user_ask": {
      "$ref": "#/definitions/nodeUserAsk"
    },
    "waiting": {
      "$ref": "#/definitions/nodeWaiting"
    }
  },
  "required": [
    "envelope_version",
    "run_id",
    "seq",
    "ts",
    "type"
  ],
  "title": "ModelRelay RunEvent",
  "type": "object"
}
